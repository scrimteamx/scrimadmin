<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legit Trades â€“ Lucky Block Opener</title>
    <style>
        /*
        README:
        This is a single-file web application. To deploy, simply host this HTML file on any static hosting service
        such as GitHub Pages, Vercel, Netlify, or a simple web server. No build process or dependencies are required.
        The lucky block image is embedded as a Base64 URI to maintain the single-file structure.
        */

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@600&display=swap');

        :root {
            --glow-purple: #a855f7;
            --glow-gold: #facc15;
            --glow-cyan: #22d3ee;
            --glow-grey: #9ca3af;
            --bg-color: #0c0a09;
        }

        /* --- Base Setup --- */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent scrollbars from canvas/animations */
        }

        body {
            background-color: var(--bg-color);
            color: #fff;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        /* --- Futuristic Background --- */
        #particle-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.5;
        }

        /* --- Main Container --- */
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            perspective: 1000px; /* For 3D transforms */
            z-index: 1;
        }
        
        /* --- Lucky Block Styling & Animation --- */
        .lucky-block {
            width: clamp(150px, 30vw, 250px);
            cursor: pointer;
            animation: float 6s ease-in-out infinite;
            transition: transform 0.5s ease-out, opacity 0.5s ease-out;
            filter: drop-shadow(0 0 15px rgba(74, 222, 128, 0.4));
        }

        .lucky-block.opening {
            animation: shake-and-open 1s ease-in-out forwards;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0px); }
        }

        @keyframes shake-and-open {
            0% { transform: translateY(0) scale(1) rotate(0deg); }
            10%, 30% { transform: translateY(-5px) scale(1.05) rotate(-2deg); }
            20%, 40% { transform: translateY(5px) scale(1.05) rotate(2deg); }
            50% { transform: translateY(0) scale(1.1); }
            100% { transform: scale(0) rotate(180deg); opacity: 0; }
        }

        /* --- Instruction Text --- */
        .instruction-text {
            margin-top: 2rem;
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            letter-spacing: 1px;
            animation: flicker 4s linear infinite;
            text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px #4ade80, 0 0 20px #4ade80;
            position: relative;
        }

        .instruction-text::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0%;
            height: 4px;
            background: linear-gradient(90deg, var(--glow-cyan), #4ade80);
            border-radius: 2px;
            box-shadow: 0 0 8px var(--glow-cyan);
        }

        .instruction-text.holding::after {
            animation: fill-progress 3s linear forwards;
        }

        @keyframes fill-progress {
            from { width: 0%; }
            to { width: 100%; }
        }

        @keyframes flicker {
            0%, 100% { opacity: 1; text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px #4ade80, 0 0 20px #4ade80; }
            50.0% { opacity: 0.9; text-shadow: 0 0 5px #fff, 0 0 8px #fff, 0 0 12px #4ade80, 0 0 18px #4ade80; }
            50.5% { opacity: 1; text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px #4ade80, 0 0 20px #4ade80; }
            51.0% { opacity: 0.8; text-shadow: none; }
            51.5% { opacity: 1; text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px #4ade80, 0 0 20px #4ade80; }
        }
        
        /* --- Mobile 'E' Hold Button --- */
        #mobile-hold-btn {
            display: none; /* Hidden by default, shown on touch devices */
            margin-top: 20px;
            width: 80px;
            height: 80px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            color: white;
            font-size: 2rem;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
            user-select: none; /* Prevent text selection */
            position: relative;
            overflow: hidden;
        }

        #mobile-hold-btn::before {
            content: 'E';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
        }
        
        #mobile-hold-btn .progress-circle {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: conic-gradient(var(--glow-cyan) 0%, #4ade80 0%, transparent 0%);
            z-index: 1;
        }

        #mobile-hold-btn.holding .progress-circle { animation: fill-circle 3s linear forwards; }
        @keyframes fill-circle { from { background: conic-gradient(var(--glow-cyan) 0%, #4ade80 0%, transparent 0%); } to { background: conic-gradient(var(--glow-cyan) 0%, #4ade80 100%, transparent 0%); } }
        
        @media (hover: none) and (pointer: coarse) { #mobile-hold-btn { display: block; } }


        /* --- Result Display --- */
        .result-container {
            position: absolute; font-size: clamp(2rem, 6vw, 4rem); font-weight: bold; opacity: 0;
            transform: scale(0.8); pointer-events: none;
        }
        .result-container.show { animation: glitch-reveal 0.8s forwards; }
        .result-container.secret { color: var(--glow-purple); text-shadow: 0 0 10px var(--glow-purple), 0 0 20px var(--glow-purple), 0 0 40px var(--glow-purple); animation: glitch-reveal 0.8s forwards, result-glitch-purple 5s infinite; }
        .result-container.plus-one { color: var(--glow-cyan); text-shadow: 0 0 10px var(--glow-cyan), 0 0 20px var(--glow-cyan), 0 0 40px var(--glow-cyan); }
        .result-container.god { color: var(--glow-gold); text-shadow: 0 0 10px var(--glow-gold), 0 0 20px var(--glow-gold), 0 0 40px var(--glow-gold); animation: glitch-reveal 0.8s forwards, result-glitch-gold 5s infinite; }
        .result-container.none { color: var(--glow-grey); text-shadow: 0 0 5px var(--glow-grey); animation: static-fade-in 1.5s forwards; }
        @keyframes glitch-reveal { 0% { transform: scale(0.8) skew(-10deg); opacity: 0; } 20% { transform: scale(1.1) skew(10deg); text-shadow: 0 0 40px red; } 40% { transform: scale(0.9) skew(-5deg); text-shadow: 0 0 40px blue; } 60% { transform: scale(1.05) skew(5deg); } 100% { transform: scale(1) skew(0deg); opacity: 1; } }
        @keyframes static-fade-in { 0% { opacity: 0; filter: blur(10px); } 20% { opacity: 0.3; filter: blur(5px); text-shadow: 0 0 1px #fff, 2px 2px 1px #fff; } 60% { opacity: 0.5; filter: blur(2px); } 100% { opacity: 1; filter: blur(0); } }
        .result-container.secret::before, .result-container.secret::after, .result-container.god::before, .result-container.god::after { content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); overflow: hidden; }
        .result-container.secret::before { left: 2px; text-shadow: -2px 0 var(--glow-cyan); animation: result-glitch-anim-1 2s infinite linear alternate-reverse; }
        .result-container.secret::after { left: -2px; text-shadow: -2px 0 var(--glow-gold), 2px 2px var(--glow-cyan); animation: result-glitch-anim-2 2s infinite linear alternate-reverse; }
        .result-container.god::before { left: 2px; text-shadow: -2px 0 #ff00c1; animation: result-glitch-anim-1 3s infinite linear alternate-reverse; }
        .result-container.god::after { left: -2px; text-shadow: -2px 0 #00fff9, 2px 2px #ff00c1; animation: result-glitch-anim-2 3s infinite linear alternate-reverse; }
        @keyframes result-glitch-anim-1 { 0% { clip-path: inset(15% 0 86% 0); } 25% { clip-path: inset(53% 0 15% 0); } 50% { clip-path: inset(5% 0 57% 0); } 75% { clip-path: inset(77% 0 11% 0); } 100% { clip-path: inset(48% 0 48% 0); } }
        @keyframes result-glitch-anim-2 { 0% { clip-path: inset(78% 0 8% 0); } 25% { clip-path: inset(18% 0 54% 0); } 50% { clip-path: inset(93% 0 2% 0); } 75% { clip-path: inset(45% 0 23% 0); } 100% { clip-path: inset(1% 0 95% 0); } }

        /* --- Particle Burst Effect --- */
        .particle { position: absolute; background: #fff; border-radius: 50%; pointer-events: none; opacity: 0; }
        .instruction-text.fading { transition: opacity 0.3s ease-in-out; opacity: 0; }
        
        /* --- Notification, Admin, and Logs UI --- */
        #notification { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); padding: 1rem 2rem; background-color: rgba(12, 10, 9, 0.85); backdrop-filter: blur(5px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 0.5rem; color: #fff; z-index: 1000; font-size: clamp(1rem, 2.5vw, 1.2rem); transition: top 0.5s cubic-bezier(0.25, 1, 0.5, 1); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); text-shadow: 0 0 5px rgba(0,0,0,0.5); }
        #notification.show { top: 25px; }
        #notification.secret { border-top: 3px solid var(--glow-purple); }
        #notification.plus-one { border-top: 3px solid var(--glow-cyan); }
        #notification.god { border-top: 3px solid var(--glow-gold); }
        #notification.none { border-top: 3px solid var(--glow-grey); }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(5px);
            z-index: 2000; display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .overlay.show { opacity: 1; visibility: visible; }

        #admin-input {
            padding: 1rem; font-size: 1.5rem; width: 250px; text-align: center;
            background: rgba(255,255,255,0.1); border: 1px solid var(--glow-cyan); border-radius: 8px;
            color: white; font-family: 'Inter', sans-serif; outline: none; box-shadow: 0 0 15px var(--glow-cyan);
        }

        #reward-logs-btn {
            position: fixed; bottom: 20px; left: 20px; padding: 10px 20px;
            font-family: 'Inter', sans-serif; font-size: 1rem; color: white;
            background: rgba(255, 255, 255, 0.1); border: 1px solid var(--glow-cyan);
            border-radius: 8px; cursor: pointer; transition: background 0.3s, box-shadow 0.3s; z-index: 100;
        }
        #reward-logs-btn:hover { background: rgba(255, 255, 255, 0.2); box-shadow: 0 0 10px var(--glow-cyan); }

        #logs-container {
            width: clamp(300px, 90vw, 500px); max-height: 80vh;
            background: rgba(12, 10, 9, 0.9); border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px; padding: 2rem; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: flex; flex-direction: column;
        }
        #logs-container h2 { margin-top: 0; color: var(--glow-cyan); }
        #logs-list { overflow-y: auto; }
        .log-item {
            margin-bottom: 10px; padding: 10px; border-radius: 5px; background: rgba(0,0,0,0.2);
            display: flex; justify-content: space-between; align-items: center; border-left: 3px solid var(--glow-grey);
        }
        .log-item .reward-text { font-weight: bold; font-size: 1.1rem; }
        .log-item .reward-date { font-size: 0.8rem; color: #aaa; }
        .log-item .secret { color: var(--glow-purple); text-shadow: 0 0 5px var(--glow-purple); }
        .log-item.secret-border { border-left-color: var(--glow-purple); }
        .log-item .plus-one { color: var(--glow-cyan); text-shadow: 0 0 5px var(--glow-cyan); }
        .log-item.plus-one-border { border-left-color: var(--glow-cyan); }
        .log-item .god { color: var(--glow-gold); text-shadow: 0 0 5px var(--glow-gold); }
        .log-item.god-border { border-left-color: var(--glow-gold); }
        .log-item .none { color: var(--glow-grey); }

    </style>
</head>
<body>
    <div id="notification"></div>
    <div id="admin-overlay" class="overlay">
        <input type="password" id="admin-input" placeholder="Enter Admin Code">
    </div>
    <div id="logs-overlay" class="overlay">
        <div id="logs-container">
            <h2>Recent Rewards</h2>
            <div id="logs-list"></div>
        </div>
    </div>
    <button id="reward-logs-btn">Reward Logs</button>
    <canvas id="particle-canvas"></canvas>
    <main class="container">
        <img src="https://steal-a-brainrot.wiki/wp-content/uploads/2025/08/Secret-Lucky-Block.png"
             onerror="this.onerror=null;this.src='https://placehold.co/250x250/0c0a09/4ade80?text=Error';"
             alt="Lucky Block" class="lucky-block">
        <p class="instruction-text" id="instruction-text">Hold 'E' to Open</p>
        <button id="mobile-hold-btn">
             <div class="progress-circle"></div>
        </button>
        <div class="result-container" id="result-container" data-text=""></div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Element References ---
            const luckyBlock = document.querySelector('.lucky-block');
            const instructionText = document.getElementById('instruction-text');
            const resultContainer = document.getElementById('result-container');
            const body = document.body;
            const mobileHoldBtn = document.getElementById('mobile-hold-btn');
            const adminOverlay = document.getElementById('admin-overlay');
            const adminInput = document.getElementById('admin-input');
            const rewardLogsBtn = document.getElementById('reward-logs-btn');
            const logsOverlay = document.getElementById('logs-overlay');
            const logsList = document.getElementById('logs-list');

            // --- State Management ---
            let isHolding = false;
            let canOpen = true;
            let holdTimeout;
            let cooldownInterval;
            let guaranteedResult = sessionStorage.getItem('guaranteedResult') || null;
            const HOLD_DURATION = 3000;
            const COOLDOWN_DURATION = 24 * 60 * 60 * 1000;
            const STORAGE_KEY = 'luckyBlockLastOpened';
            const LOGS_STORAGE_KEY = 'luckyBlockRewardLogs';

            // --- Audio Setup ---
            const openingSoundData = 'data:audio/mpeg;base64,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';
            const openingAudio = new Audio(openingSoundData);
            openingAudio.volume = 0.7;
            
            // --- Weighted Results ---
            const results = [ { text: 'Secret', class: 'secret', weight: 1 }, { text: '+1 Opening', class: 'plus-one', weight: 2 }, { text: 'Brainrot God', class: 'god', weight: 10 }, { text: 'None', class: 'none', weight: 87 } ];

            // --- Functions ---
            function showNotification(resultOrText, typeClass = '') {
                const notification = document.getElementById('notification');
                if (typeof resultOrText === 'object') {
                    notification.textContent = `You received: ${resultOrText.text}`;
                    notification.className = 'notification show';
                    notification.classList.add(resultOrText.class);
                } else {
                    notification.textContent = resultOrText;
                    notification.className = `notification show ${typeClass}`;
                }
                setTimeout(() => notification.classList.remove('show'), 4000);
            }

            function saveRewardLog(result) {
                let logs = JSON.parse(localStorage.getItem(LOGS_STORAGE_KEY)) || [];
                const newLog = {
                    text: result.text,
                    class: result.class,
                    date: new Date().toISOString()
                };
                logs.unshift(newLog);
                logs = logs.slice(0, 5); // Keep only the latest 5
                localStorage.setItem(LOGS_STORAGE_KEY, JSON.stringify(logs));
            }

            function startResultRoulette(finalResult) {
                const rouletteItems = [ { text: 'None', class: 'none' }, { text: 'Brainrot God', class: 'god' }, { text: '+1 Opening', class: 'plus-one' }, { text: 'Secret', class: 'secret' }, { text: 'None', class: 'none' }, { text: 'Brainrot God', class: 'god' }, { text: '+1 Opening', class: 'plus-one' }, { text: 'Secret', class: 'secret' }, { text: 'None', class: 'none' }, { text: 'Brainrot God', class: 'god' }, { text: '+1 Opening', class: 'plus-one' }, { text: 'Secret', class: 'secret' }, { text: 'None', class: 'none' }, { text: 'Brainrot God', class: 'god' }, { text: '+1 Opening', class: 'plus-one' }, { text: 'Secret', class: 'secret' }, { text: 'None', class: 'none' }, { text: 'Brainrot God', class: 'god' }, { text: '+1 Opening', class: 'plus-one' }, { text: 'Secret', class: 'secret' }, { text: 'None', class: 'none' }, { text: 'Brainrot God', class: 'god' }, { text: '+1 Opening', class: 'plus-one' }, { text: 'Secret', class: 'secret' }, { text: 'None', class: 'none' }, { text: 'Brainrot God', class: 'god' }, { text: '+1 Opening', class: 'plus-one' }, { text: 'Secret', class: 'secret' } ];
                let currentIndex = 0;
                const intervalDuration = 180;
                const rouletteInterval = setInterval(() => {
                    if (currentIndex < rouletteItems.length) {
                        const currentItem = rouletteItems[currentIndex];
                        resultContainer.textContent = currentItem.text;
                        resultContainer.dataset.text = currentItem.text;
                        resultContainer.className = 'result-container show';
                        resultContainer.classList.add(currentItem.class);
                        currentIndex++;
                    } else {
                        clearInterval(rouletteInterval);
                        resultContainer.textContent = finalResult.text;
                        resultContainer.dataset.text = finalResult.text;
                        resultContainer.className = 'result-container';
                        resultContainer.classList.add(finalResult.class, 'show');
                        showNotification(finalResult);
                        saveRewardLog(finalResult);
                        if (finalResult.class !== 'plus-one') {
                            localStorage.setItem(STORAGE_KEY, Date.now().toString());
                            setTimeout(resetUI, 4000);
                        } else {
                            setTimeout(() => location.reload(), 3000);
                        }
                    }
                }, intervalDuration);
            }

            function resetUI() {
                resultContainer.className = 'result-container';
                luckyBlock.style.display = 'block';
                luckyBlock.classList.remove('opening');
                instructionText.style.visibility = 'visible';
                instructionText.classList.remove('fading', 'holding');
                mobileHoldBtn.classList.remove('holding');
                checkCooldown();
            }
            
            function updateCooldownTimer(endTime) {
                clearInterval(cooldownInterval);
                cooldownInterval = setInterval(() => {
                    const timeLeft = endTime - Date.now();
                    if (timeLeft <= 0) {
                        clearInterval(cooldownInterval);
                        canOpen = true;
                        instructionText.textContent = `Hold 'E' to Open`;
                        instructionText.style.animation = '';
                        instructionText.style.textShadow = '';
                        return;
                    }
                    const hours = String(Math.floor((timeLeft / (1000 * 60 * 60)) % 24)).padStart(2,'0');
                    const minutes = String(Math.floor((timeLeft / 1000 / 60) % 60)).padStart(2, '0');
                    const seconds = String(Math.floor((timeLeft / 1000) % 60)).padStart(2, '0');
                    instructionText.textContent = `Come back in ${hours}:${minutes}:${seconds}`;
                }, 1000);
            }

            function checkCooldown() {
                const lastOpened = localStorage.getItem(STORAGE_KEY);
                if (lastOpened) {
                    const timeSinceLastOpen = Date.now() - parseInt(lastOpened, 10);
                    if (timeSinceLastOpen < COOLDOWN_DURATION) {
                        canOpen = false;
                        const endTime = parseInt(lastOpened, 10) + COOLDOWN_DURATION;
                        updateCooldownTimer(endTime);
                        instructionText.style.animation = 'none';
                        instructionText.style.textShadow = '0 0 8px var(--glow-grey)';
                    } else {
                        canOpen = true;
                         instructionText.textContent = `Hold 'E' to Open`;
                    }
                }
            }

            function determineResult() {
                if (guaranteedResult) {
                    const result = results.find(r => r.class === guaranteedResult);
                    guaranteedResult = null;
                    sessionStorage.removeItem('guaranteedResult');
                    return result || results[results.length - 1];
                }
                const totalWeight = results.reduce((sum, result) => sum + result.weight, 0);
                let random = Math.random() * totalWeight;
                for (const result of results) {
                    if (random < result.weight) return result;
                    random -= result.weight;
                }
                return results[results.length - 1];
            }

            function createParticleBurst() {
                const particleCount = 80;
                const colors = ['var(--glow-purple)', 'var(--glow-gold)', 'var(--glow-cyan)', '#fff'];
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.classList.add('particle');
                    body.appendChild(particle);
                    const size = Math.random() * 6 + 2;
                    const angle = Math.random() * 360;
                    const radius = Math.random() * 150 + 50;
                    const xStart = window.innerWidth / 2;
                    const yStart = window.innerHeight / 2;
                    const xEnd = xStart + radius * Math.cos(angle * Math.PI / 180);
                    const yEnd = yStart + radius * Math.sin(angle * Math.PI / 180);
                    particle.style.width = `${size}px`; particle.style.height = `${size}px`;
                    particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                    particle.style.left = `${xStart}px`; particle.style.top = `${yStart}px`;
                    particle.animate([ { transform: 'translate(-50%, -50%) scale(1)', opacity: 1 }, { transform: `translate(${xEnd - xStart}px, ${yEnd - yStart}px) scale(0)`, opacity: 0 } ], { duration: Math.random() * 800 + 400, easing: 'cubic-bezier(0.1, 0.7, 1.0, 0.1)', fill: 'forwards' });
                    setTimeout(() => particle.remove(), 1200);
                }
            }

            function openBlock() {
                luckyBlock.classList.add('opening');
                instructionText.style.visibility = 'hidden';
                openingAudio.play().catch(error => console.error("Audio playback failed.", error));
                createParticleBurst();
                luckyBlock.addEventListener('animationend', () => {
                    luckyBlock.style.display = 'none';
                    const result = determineResult();
                    startResultRoulette(result);
                }, { once: true });
            }

            function handlePressStart(e) {
                e.preventDefault();
                if (isHolding || !canOpen) return;
                isHolding = true;
                instructionText.classList.add('holding', 'fading');
                mobileHoldBtn.classList.add('holding');
                holdTimeout = setTimeout(openBlock, HOLD_DURATION);
            }

            function handlePressEnd(e) {
                 e.preventDefault();
                if (!canOpen) return;
                isHolding = false;
                clearTimeout(holdTimeout);
                instructionText.classList.remove('holding', 'fading');
                mobileHoldBtn.classList.remove('holding');
            }
            
            function handleAdminMacro(e) {
                if(e.altKey && e.key.toLowerCase() === 'l') {
                    e.preventDefault();
                    adminOverlay.classList.add('show');
                    adminInput.focus();
                }
            }
            
            function handleAdminInput(e) {
                const code = e.target.value;
                let notificationText = '', notificationClass = 'plus-one', guaranteeType = null;
                switch(code) {
                    case '9154': notificationText = 'Lucky Block has been reset!'; break;
                    case '0990': notificationText = 'Next opening will be Secret!'; notificationClass = 'secret'; guaranteeType = 'secret'; break;
                    case '9009': notificationText = 'Next opening will be +1 Opening!'; notificationClass = 'plus-one'; guaranteeType = 'plus-one'; break;
                    default: return;
                }
                localStorage.removeItem(STORAGE_KEY);
                if(guaranteeType) { sessionStorage.setItem('guaranteedResult', guaranteeType); }
                adminOverlay.classList.remove('show');
                e.target.value = '';
                showNotification(notificationText, notificationClass);
                setTimeout(() => window.location.reload(), 1500);
            }

            function displayRewardLogs() {
                logsList.innerHTML = ''; // Clear previous logs
                const logs = JSON.parse(localStorage.getItem(LOGS_STORAGE_KEY)) || [];
                if (logs.length === 0) {
                    logsList.innerHTML = '<p>No rewards logged yet.</p>';
                } else {
                    logs.forEach(log => {
                        const logItem = document.createElement('div');
                        logItem.className = `log-item ${log.class}-border`;

                        const rewardText = document.createElement('span');
                        rewardText.className = `reward-text ${log.class}`;
                        rewardText.textContent = log.text;

                        const rewardDate = document.createElement('span');
                        rewardDate.className = 'reward-date';
                        rewardDate.textContent = new Date(log.date).toLocaleString();

                        logItem.appendChild(rewardText);
                        logItem.appendChild(rewardDate);
                        logsList.appendChild(logItem);
                    });
                }
                logsOverlay.classList.add('show');
            }

            // --- Event Listeners ---
            window.addEventListener('keydown', handleAdminMacro);
            adminInput.addEventListener('input', handleAdminInput);
            adminOverlay.addEventListener('click', (e) => { if (e.target === adminOverlay) adminOverlay.classList.remove('show'); });

            rewardLogsBtn.addEventListener('click', displayRewardLogs);
            logsOverlay.addEventListener('click', (e) => { if (e.target === logsOverlay) logsOverlay.classList.remove('show'); });

            window.addEventListener('keydown', (e) => { if(e.key.toLowerCase() === 'e') handlePressStart(e) });
            window.addEventListener('keyup', (e) => { if(e.key.toLowerCase() === 'e') handlePressEnd(e) });
            mobileHoldBtn.addEventListener('touchstart', handlePressStart, { passive: false });
            mobileHoldBtn.addEventListener('touchend', handlePressEnd, { passive: false });
            
            // --- Background Particle Animation ---
            const canvas = document.getElementById('particle-canvas'); const ctx = canvas.getContext('2d');
            let particlesArray;
            function setupCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
            class Particle { constructor() { this.x = Math.random() * canvas.width; this.y = Math.random() * canvas.height; this.size = Math.random() * 2 + 0.5; this.speedX = Math.random() * 1 - 0.5; this.speedY = Math.random() * 1 - 0.5; this.color = `rgba(74, 222, 128, ${Math.random()})`; } update() { if (this.x > canvas.width || this.x < 0) this.speedX *= -1; if (this.y > canvas.height || this.y < 0) this.speedY *= -1; this.x += this.speedX; this.y += this.speedY; } draw() { ctx.fillStyle = this.color; ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill(); } }
            function initParticles() { particlesArray = []; let n = (canvas.height * canvas.width) / 9000; for (let i = 0; i < n; i++) { particlesArray.push(new Particle()); } }
            function animateParticles() { ctx.clearRect(0, 0, canvas.width, canvas.height); for (let i = 0; i < particlesArray.length; i++) { particlesArray[i].update(); particlesArray[i].draw(); } requestAnimationFrame(animateParticles); }
            window.addEventListener('resize', () => { setupCanvas(); initParticles(); });

            // --- Initial Setup ---
            checkCooldown(); setupCanvas(); initParticles(); animateParticles();
        });
    </script>
</body>
</html>

